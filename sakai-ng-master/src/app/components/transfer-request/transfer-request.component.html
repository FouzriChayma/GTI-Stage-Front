<div class="min-h-screen bg-gray-50 dark:bg-gray-900 p-4">
  <!-- List Mode -->
  <div *ngIf="mode === 'list'" class="space-y-6">
    <!-- Enhanced Toolbar -->
    <div class="enhanced-card hover-glow smooth-transition">
      <div class="enhanced-toolbar">
        <div class="toolbar-left">
          <button 
            pButton 
            pRipple 
            label="New Transfer" 
            icon="pi pi-plus" 
            class="btn-success smooth-transition hover-lift"
            (click)="openNew()">
          </button>
          <button
            pButton
            pRipple
            label="Delete Selected"
            icon="pi pi-trash"
            class="btn-danger smooth-transition hover-lift"
            [disabled]="!selectedTransferRequests?.length"
            (click)="deleteSelectedTransferRequests()">
          </button>
        </div>
        
      </div>
    </div>

    <!-- Enhanced Search Filters Section -->
    <div class="enhanced-card hover-glow smooth-transition">
      <!-- Collapsible Header -->
      <div class="search-filters-header" (click)="toggleFilters()">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
            <i class="pi pi-filter text-blue-600 dark:text-blue-400"></i>
          </div>
          <div>
            <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Search Filters</h5>
            <p class="text-sm text-gray-500 dark:text-gray-400">
              {{ getActiveFiltersCount() }} filter(s) active
            </p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <!-- Quick Filter Badges -->
          <div class="hidden md:flex items-center gap-2">
            <span *ngIf="searchCriteria.status" 
                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
              <i class="pi pi-tag mr-1 text-xs"></i>
              {{ searchCriteria.status }}
            </span>
            <span *ngIf="searchCriteria.transferType" 
                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
              <i class="pi pi-send mr-1 text-xs"></i>
              {{ searchCriteria.transferType }}
            </span>
            <span *ngIf="searchCriteria.userId" 
                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">
              <i class="pi pi-user mr-1 text-xs"></i>
              ID: {{ searchCriteria.userId }}
            </span>
          </div>
          
          <!-- Toggle Button -->
          <button 
            type="button"
            class="search-toggle-btn"
            [class.expanded]="filtersExpanded">
            <i class="pi" [class.pi-chevron-down]="!filtersExpanded" [class.pi-chevron-up]="filtersExpanded"></i>
          </button>
        </div>
      </div>

      <!-- Expandable Filters Content -->
      <div class="search-filters-content" [class.expanded]="filtersExpanded">
        <div class="enhanced-card-body">
          <!-- Quick Actions Row -->
          <div class="flex flex-wrap items-center gap-3 mb-6 pb-4 border-b border-gray-200 dark:border-gray-600">
            <button 
              type="button"
              class="quick-filter-btn"
              [class.active]="quickFilter === 'pending'"
              (click)="setQuickFilter('pending')">
              <i class="pi pi-clock mr-2"></i>
              Pending
            </button>
            <button 
              type="button"
              class="quick-filter-btn"
              [class.active]="quickFilter === 'validated'"
              (click)="setQuickFilter('validated')">
              <i class="pi pi-check-circle mr-2"></i>
              Validated
            </button>
            <button 
              type="button"
              class="quick-filter-btn"
              [class.active]="quickFilter === 'commercial'"
              (click)="setQuickFilter('commercial')">
              <i class="pi pi-shopping-cart mr-2"></i>
              Commercial
            </button>
            <button 
              type="button"
              class="quick-filter-btn"
              [class.active]="quickFilter === 'today'"
              (click)="setQuickFilter('today')">
              <i class="pi pi-calendar mr-2"></i>
              Today
            </button>
          </div>

          <!-- Advanced Filters Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            <!-- User ID -->
            <div class="form-field">
              <label for="searchUserId" class="enhanced-form-label">
                <i class="pi pi-user text-blue-600 dark:text-blue-400 mr-2"></i>
                User ID
                <span class="text-red-500 ml-1">*</span>
              </label>
              <div class="enhanced-input-wrapper">
                <p-inputNumber 
                  id="searchUserId"
                  [(ngModel)]="searchCriteria.userId"
                  [min]="0"
                  placeholder="Enter user ID"
                  styleClass="w-full enhanced-input">
                </p-inputNumber>
              </div>
            </div>

            <!-- Commission Account -->
            <div class="form-field">
              <label for="searchCommissionAccount" class="enhanced-form-label">
                <i class="pi pi-credit-card text-green-600 dark:text-green-400 mr-2"></i>
                Commission Account
              </label>
              <div class="enhanced-input-wrapper">
                <input
                  pInputText
                  id="searchCommissionAccount"
                  [(ngModel)]="searchCriteria.commissionAccountNumber"
                  placeholder="Enter account number"
                  class="enhanced-input"
                />
              </div>
            </div>

            <!-- Transfer Type -->
            <div class="form-field">
              <label for="searchTransferType" class="enhanced-form-label">
                <i class="pi pi-send text-purple-600 dark:text-purple-400 mr-2"></i>
                Transfer Type
              </label>
              <div class="enhanced-input-wrapper">
                <p-dropdown
                  id="searchTransferType"
                  [options]="transferTypes"
                  [(ngModel)]="searchCriteria.transferType"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select type"
                  styleClass="w-full enhanced-dropdown">
                </p-dropdown>
              </div>
            </div>

            <!-- Status -->
            <div class="form-field">
              <label for="searchStatus" class="enhanced-form-label">
                <i class="pi pi-flag text-orange-600 dark:text-orange-400 mr-2"></i>
                Status
              </label>
              <div class="enhanced-input-wrapper">
                <p-dropdown
                  id="searchStatus"
                  [options]="statuses"
                  [(ngModel)]="searchCriteria.status"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select status"
                  styleClass="w-full enhanced-dropdown">
                </p-dropdown>
              </div>
            </div>

            <!-- Amount -->
            <div class="form-field">
              <label for="searchAmount" class="enhanced-form-label">
                <i class="pi pi-dollar text-emerald-600 dark:text-emerald-400 mr-2"></i>
                Amount
              </label>
              <div class="enhanced-input-wrapper">
                <p-inputNumber 
                  id="searchAmount"
                  [(ngModel)]="searchCriteria.amount"
                  [min]="0"
                  mode="currency"
                  currency="TND"
                  placeholder="Enter amount"
                  styleClass="w-full enhanced-input">
                </p-inputNumber>
              </div>
            </div>
          </div>

          <!-- Date Range Filter -->
          

          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row justify-between items-center gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-600">
            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
              <i class="pi pi-info-circle"></i>
              <span>{{ getTotalResults() }} results found</span>
            </div>
            <div class="flex items-center gap-3">
              <button 
                pButton 
                pRipple 
                type="button"
                class="enhanced-btn-secondary"
                (click)="clearAllFilters()">
                <i class="pi pi-times mr-2"></i>
                Clear All
              </button>
              <button 
                pButton 
                pRipple 
                type="button"
                class="enhanced-btn-primary"
                (click)="applyFilters()"
                [disabled]="isSearching">
                <i class="pi pi-search mr-2" *ngIf="!isSearching"></i>
                <i class="pi pi-spin pi-spinner mr-2" *ngIf="isSearching"></i>
                {{ isSearching ? 'Searching...' : 'Apply Filters' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Table (Full width now) -->
    <div class="enhanced-table-container">
      <p-table
        #dt
        [value]="transferRequests()"
        [rows]="10"
        [paginator]="true"
        [globalFilterFields]="['idTransferRequest', 'userId', 'commissionAccountNumber', 'transferType', 'amount', 'currency', 'status', 'beneficiary_name']"
        [(selection)]="selectedTransferRequests"
        [rowHover]="true"
        dataKey="idTransferRequest"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rowsPerPageOptions]="[5, 10, 25]"
        styleClass="p-datatable-sm">
        
        <ng-template pTemplate="header">
          <tr class="table-header">
            <th class="table-header-cell w-12">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th *ngFor="let col of cols" [pSortableColumn]="col.field" class="table-header-cell">
              {{ col.header }}
              <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
            <th class="table-header-cell w-32">Actions</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-transferRequest>
          <tr class="table-row">
            <td class="table-cell">
              <p-tableCheckbox [value]="transferRequest"></p-tableCheckbox>
            </td>
            <td class="table-cell font-mono text-sm">{{ transferRequest.idTransferRequest }}</td>
            <td class="table-cell">{{ transferRequest.userId }}</td>
            <td class="table-cell font-mono text-xs">{{ transferRequest.commissionAccountNumber }}</td>
            <td class="table-cell">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                {{ transferRequest.transferType }}
              </span>
            </td>
            <td class="table-cell font-semibold">{{ transferRequest.amount | currency: transferRequest.currency }}</td>
            <td class="table-cell font-mono">{{ transferRequest.currency }}</td>
            <td class="table-cell">
              <span [class]="'status-badge status-' + (transferRequest.status?.toLowerCase() || 'pending')">
                {{ transferRequest.status || 'PENDING' }}
              </span>
            </td>
            <td class="table-cell">{{ transferRequest.beneficiary?.name }}</td>
            <td class="table-cell">
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200">
                {{ transferRequest.documents?.length || 0 }} docs
              </span>
            </td>
            <td class="table-cell">
              <div class="action-buttons">
                <button
                  pButton
                  pRipple
                  icon="pi pi-eye"
                  class="action-btn action-btn-view"
                  pTooltip="View Details"
                  (click)="viewDetails(transferRequest.idTransferRequest)">
                </button>
                <button
                  pButton
                  pRipple
                  icon="pi pi-pencil"
                  class="action-btn action-btn-edit"
                  [disabled]="isEditDisabled(transferRequest.status)"
                  [pTooltip]="isEditDisabled(transferRequest.status) ? 'Cannot edit: Transfer request is ' + transferRequest.status : 'Edit'"
                  (click)="editTransferRequest(transferRequest)">
                </button>
                <button
                  pButton
                  pRipple
                  icon="pi pi-trash"
                  class="action-btn action-btn-delete"
                  pTooltip="Delete"
                  (click)="deleteTransferRequest(transferRequest)">
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="cols.length + 2" class="table-cell text-center py-8">
              <div class="flex flex-col items-center">
                <i class="pi pi-inbox text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500 dark:text-gray-400">No transfer requests found.</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <!-- New/Edit Mode -->
  <div *ngIf="mode === 'new' || mode === 'edit'" class="space-y-6 fade-in smooth-transition">
    <!-- Header -->
    <div class="enhanced-card hover-glow smooth-transition">
      <div class="enhanced-toolbar">
        <div class="toolbar-left">
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            {{ mode === 'new' ? 'New Transfer Request' : 'Edit Transfer Request' }}
          </h3>
        </div>
        <div class="toolbar-right">
          <button 
            pButton 
            pRipple 
            label="Save" 
            icon="pi pi-check" 
            class="btn-success smooth-transition hover-lift"
            [disabled]="isSaving" 
            (click)="saveTransferRequest()">
          </button>
          <button 
            pButton 
            pRipple 
            label="Cancel" 
            icon="pi pi-times" 
            class="btn-secondary smooth-transition hover-lift"
            (click)="hideDialog()">
          </button>
        </div>
      </div>
    </div>

    <!-- Form Sections -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Basic Information -->
      <div class="form-section hover-glow smooth-transition">
        <h5 class="form-section-title">Basic Information</h5>
        
        <div class="space-y-4">
          <div class="form-field">
            <label for="userId" class="form-label form-required">User ID</label>
            <p-inputNumber 
              id="userId"
              [(ngModel)]="transferRequest.userId"
              [min]="1"
              [required]="true"
              styleClass="w-full">
            </p-inputNumber>
          </div>
          
          <div class="form-field">
            <label for="commissionAccountNumber" class="form-label form-required">Commission Account Number</label>
            <input
              pInputText
              id="commissionAccountNumber"
              [(ngModel)]="transferRequest.commissionAccountNumber"
              [minlength]="10"
              [maxlength]="34"
              required
              class="form-input"
              placeholder="Enter commission account number"
            />
          </div>
          
          <div class="form-field">
            <label for="commissionAccountType" class="form-label form-required">Commission Account Type</label>
            <p-dropdown
              id="commissionAccountType"
              [options]="accountTypes"
              [(ngModel)]="transferRequest.commissionAccountType"
              optionLabel="label"
              optionValue="value"
              required
              styleClass="w-full">
            </p-dropdown>
          </div>
          
          <div class="form-field">
            <label for="settlementAccountNumber" class="form-label form-required">Settlement Account Number</label>
            <input
              pInputText
              id="settlementAccountNumber"
              [(ngModel)]="transferRequest.settlementAccountNumber"
              [minlength]="10"
              [maxlength]="34"
              required
              class="form-input"
              placeholder="Enter settlement account number"
            />
          </div>
          
          <div class="form-field">
            <label for="settlementAccountType" class="form-label form-required">Settlement Account Type</label>
            <p-dropdown
              id="settlementAccountType"
              [options]="accountTypes"
              [(ngModel)]="transferRequest.settlementAccountType"
              optionLabel="label"
              optionValue="value"
              required
              styleClass="w-full">
            </p-dropdown>
          </div>
        </div>
      </div>

      <!-- Transfer Details -->
      <div class="form-section hover-glow smooth-transition">
        <h5 class="form-section-title">Transfer Details</h5>
        
        <div class="space-y-4">
          <div class="form-field">
            <label for="transferType" class="form-label form-required">Transfer Type</label>
            <p-dropdown
              id="transferType"
              [options]="transferTypes"
              [(ngModel)]="transferRequest.transferType"
              optionLabel="label"
              optionValue="value"
              required
              (ngModelChange)="onTransferTypeChange()"
              styleClass="w-full">
            </p-dropdown>
          </div>
          
          <div class="form-field">
            <label for="issueDate" class="form-label form-required">Issue Date</label>
            <input
              pInputText
              id="issueDate" 
              [(ngModel)]="transferRequest.issueDate"
              type="date"
              required
              class="form-input"
            />
          </div>
          
          <div class="form-field">
            <label for="feeType" class="form-label form-required">Fee Type</label>
            <p-dropdown
              id="feeType"
              [options]="feeTypes"
              [(ngModel)]="transferRequest.feeType"
              optionLabel="label"
              optionValue="value"
              required
              styleClass="w-full">
            </p-dropdown>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div class="form-field">
              <label for="currency" class="form-label form-required">Currency</label>
              <input
                pInputText
                id="currency" 
                [(ngModel)]="transferRequest.currency"
                [maxlength]="3"
                required
                class="form-input"
                placeholder="TND"
              />
            </div>
            
            <div class="form-field">
              <label for="amount" class="form-label form-required">Amount</label>
              <p-inputNumber 
                id="amount"
                [(ngModel)]="transferRequest.amount"
                [min]="0.001"
                mode="currency"
                currency="TND"
                required
                styleClass="w-full">
              </p-inputNumber>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Commercial Transfer Fields -->
    <div *ngIf="transferRequest.transferType === 'COMMERCIAL'" class="form-section fade-in smooth-transition">
      <h5 class="form-section-title">Commercial Transfer Information</h5>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-field">
          <label for="invoiceNumber" class="form-label form-required">Invoice Number</label>
          <input
            pInputText
            id="invoiceNumber"
            [(ngModel)]="transferRequest.invoiceNumber"
            [maxlength]="50"
            required
            class="form-input"
            placeholder="Enter invoice number"
          />
        </div>
        
        <div class="form-field">
          <label for="invoiceDate" class="form-label form-required">Invoice Date</label>
          <input
            pInputText
            id="invoiceDate" 
            [(ngModel)]="transferRequest.invoiceDate"
            type="date"
            required
            class="form-input"
          />
        </div>
        
        <div class="form-field md:col-span-2">
          <label for="transferReason" class="form-label form-required">Transfer Reason</label>
          <input
            pInputText
            id="transferReason"
            [(ngModel)]="transferRequest.transferReason"
            [maxlength]="255"
            required
            class="form-input"
            placeholder="Enter transfer reason"
          />
        </div>
      </div>
    </div>

    <!-- Options -->
    <div class="form-section hover-glow smooth-transition">
      <h5 class="form-section-title">Additional Options</h5>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="enhanced-checkbox">
          <p-checkbox
            [(ngModel)]="transferRequest.isNegotiation"
            [binary]="true"
            inputId="negotiation">
          </p-checkbox>
          <label for="negotiation" class="checkbox-label">Negotiation</label>
        </div>
        
        <div class="enhanced-checkbox">
          <p-checkbox
            [(ngModel)]="transferRequest.isTermNegotiation"
            [binary]="true"
            inputId="termNegotiation">
          </p-checkbox>
          <label for="termNegotiation" class="checkbox-label">Term Negotiation</label>
        </div>
        
        <div class="enhanced-checkbox">
          <p-checkbox
            [(ngModel)]="transferRequest.isFinancing"
            [binary]="true"
            inputId="financing">
          </p-checkbox>
          <label for="financing" class="checkbox-label">Financing</label>
        </div>
      </div>
    </div>

    <!-- Beneficiary Information -->
    <div class="form-section hover-glow smooth-transition">
      <h5 class="form-section-title">Beneficiary Information</h5>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-field">
          <label for="beneficiaryName" class="form-label form-required">Beneficiary Name</label>
          <input
            pInputText
            id="beneficiaryName" 
            [(ngModel)]="transferRequest.beneficiary.name"
            [maxlength]="100"
            required
            placeholder="Enter beneficiary name"
            class="form-input"
          />
        </div>
        
        <div class="form-field">
          <label for="beneficiaryCountry" class="form-label form-required">Country</label>
          <input
            pInputText
            id="beneficiaryCountry" 
            [(ngModel)]="transferRequest.beneficiary.country"
            [maxlength]="100"
            required
            placeholder="Enter country"
            class="form-input"
          />
        </div>
        
        <div class="form-field">
          <label for="beneficiaryDestinationBank" class="form-label form-required">Destination Bank</label>
          <input
            pInputText
            id="beneficiaryDestinationBank" 
            [(ngModel)]="transferRequest.beneficiary.destinationBank"
            [maxlength]="100"
            required
            placeholder="Enter destination bank"
            class="form-input"
          />
        </div>
        
        <div class="form-field">
          <label for="beneficiaryBankAccount" class="form-label">Bank Account</label>
          <input
            pInputText
            id="beneficiaryBankAccount" 
            [(ngModel)]="transferRequest.beneficiary.bankAccount"
            [maxlength]="34"
            placeholder="Enter bank account (optional)"
            class="form-input"
          />
        </div>
      </div>
    </div>

    <!-- Documents -->
    <div class="form-section hover-glow smooth-transition">
      <h5 class="form-section-title">Documents</h5>
      
      <div class="file-upload-area">
        <p-fileUpload
          [multiple]="true"
          [maxFileSize]="1000000"
          accept="application/pdf,image/*"
          (onSelect)="onFileSelected($event)"
          [customUpload]="true"
          [files]="selectedFiles">
        </p-fileUpload>
      </div>
      
      <div *ngIf="transferRequest.documents?.length" class="mt-4 space-y-2">
        <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300">Uploaded Documents</h6>
        <div *ngFor="let doc of transferRequest.documents" class="file-item">
          <span class="file-name">{{ doc.fileName }}</span>
          <button
            pButton
            pRipple
            icon="pi pi-trash"
            class="action-btn action-btn-delete"
            (click)="deleteDocument(doc.idDocument)">
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Details Mode - Improved Design -->
  <div *ngIf="mode === 'details'" class="space-y-6 fade-in smooth-transition">
    <!-- Header -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
              <i class="pi pi-file-edit text-blue-600 dark:text-blue-400 text-lg"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Transfer Request Details</h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">ID: {{ transferRequest.idTransferRequest }}</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <button
              *ngIf="!isEditDisabled(transferRequest.status)"
              pButton
              pRipple
              label="Edit"
              icon="pi pi-pencil"
              class="btn-info smooth-transition"
              [disabled]="isLoading"
              (click)="editTransferRequest(transferRequest)">
            </button>
            <button
              pButton
              pRipple
              label="Back"
              icon="pi pi-arrow-left"
              class="btn-secondary smooth-transition"
              (click)="goBack()">
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoading; else loadingTemplate" class="space-y-6">
      <!-- Status Overview Card -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
        <div class="flex items-center justify-between mb-4">
          <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
            <i class="pi pi-info-circle text-blue-600 dark:text-blue-400"></i>
            Status Overview
          </h5>
          <span [class]="'status-badge status-' + (transferRequest.status?.toLowerCase() || 'pending')">
            {{ transferRequest.status || 'PENDING' }}
          </span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-2">
              <i class="pi pi-dollar text-green-600 dark:text-green-400 text-xl"></i>
            </div>
            <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
              {{ transferRequest.amount | currency: transferRequest.currency }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">Transfer Amount</div>
          </div>
          <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-2">
              <i class="pi pi-calendar text-blue-600 dark:text-blue-400 text-xl"></i>
            </div>
            <div class="text-lg font-semibold text-gray-900 dark:text-gray-100">
              {{ transferRequest.issueDate | date:'mediumDate' }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">Issue Date</div>
          </div>
          <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center mx-auto mb-2">
              <i class="pi pi-file text-purple-600 dark:text-purple-400 text-xl"></i>
            </div>
            <div class="text-lg font-semibold text-gray-900 dark:text-gray-100">
              {{ transferRequest.documents?.length || 0 }}
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400">Documents</div>
          </div>
        </div>
      </div>

      <!-- Basic Information -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
            <i class="pi pi-user text-blue-600 dark:text-blue-400"></i>
            Basic Information
          </h5>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-id-card text-xs"></i>
                User ID
              </div>
              <div class="text-base font-semibold text-gray-900 dark:text-gray-100">
                {{ transferRequest.userId }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-credit-card text-xs"></i>
                Commission Account
              </div>
              <div class="text-base font-mono text-gray-900 dark:text-gray-100">
                {{ transferRequest.commissionAccountNumber }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-tag text-xs"></i>
                Account Type
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                {{ transferRequest.commissionAccountType }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-credit-card text-xs"></i>
                Settlement Account
              </div>
              <div class="text-base font-mono text-gray-900 dark:text-gray-100">
                {{ transferRequest.settlementAccountNumber }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-tag text-xs"></i>
                Settlement Type
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                {{ transferRequest.settlementAccountType }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-send text-xs"></i>
                Transfer Type
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                  {{ transferRequest.transferType }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Financial Information -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
            <i class="pi pi-money-bill text-green-600 dark:text-green-400"></i>
            Financial Information
          </h5>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-percentage text-xs"></i>
                Fee Type
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                {{ transferRequest.feeType }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-globe text-xs"></i>
                Currency
              </div>
              <div class="text-base font-mono font-semibold text-gray-900 dark:text-gray-100">
                {{ transferRequest.currency }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-dollar text-xs"></i>
                Amount
              </div>
              <div class="text-xl font-bold text-green-600 dark:text-green-400">
                {{ transferRequest.amount | currency: transferRequest.currency }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Options -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
            <i class="pi pi-cog text-gray-600 dark:text-gray-400"></i>
            Additional Options
          </h5>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-3">
                <i class="pi pi-handshake text-blue-600 dark:text-blue-400"></i>
                <span class="font-medium text-gray-900 dark:text-gray-100">Negotiation</span>
              </div>
              <span [class]="transferRequest.isNegotiation ? 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200'">
                <i [class]="transferRequest.isNegotiation ? 'pi pi-check mr-1' : 'pi pi-times mr-1'"></i>
                {{ transferRequest.isNegotiation ? 'Yes' : 'No' }}
              </span>
            </div>
            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-3">
                <i class="pi pi-clock text-orange-600 dark:text-orange-400"></i>
                <span class="font-medium text-gray-900 dark:text-gray-100">Term Negotiation</span>
              </div>
              <span [class]="transferRequest.isTermNegotiation ? 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200'">
                <i [class]="transferRequest.isTermNegotiation ? 'pi pi-check mr-1' : 'pi pi-times mr-1'"></i>
                {{ transferRequest.isTermNegotiation ? 'Yes' : 'No' }}
              </span>
            </div>
            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center gap-3">
                <i class="pi pi-wallet text-purple-600 dark:text-purple-400"></i>
                <span class="font-medium text-gray-900 dark:text-gray-100">Financing</span>
              </div>
              <span [class]="transferRequest.isFinancing ? 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200'">
                <i [class]="transferRequest.isFinancing ? 'pi pi-check mr-1' : 'pi pi-times mr-1'"></i>
                {{ transferRequest.isFinancing ? 'Yes' : 'No' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Commercial Details -->
      <div *ngIf="transferRequest.transferType === 'COMMERCIAL'" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
            <i class="pi pi-shopping-cart text-indigo-600 dark:text-indigo-400"></i>
            Commercial Information
          </h5>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-file-o text-xs"></i>
                Invoice Number
              </div>
              <div class="text-base font-mono text-gray-900 dark:text-gray-100">
                {{ transferRequest.invoiceNumber }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-calendar text-xs"></i>
                Invoice Date
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                {{ transferRequest.invoiceDate | date:'mediumDate' }}
              </div>
            </div>
            <div class="md:col-span-2 space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-comment text-xs"></i>
                Transfer Reason
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                {{ transferRequest.transferReason }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Beneficiary Information -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
          <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
            <i class="pi pi-users text-teal-600 dark:text-teal-400"></i>
            Beneficiary Information
          </h5>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-user text-xs"></i>
                Beneficiary Name
              </div>
              <div class="text-base font-semibold text-gray-900 dark:text-gray-100">
                {{ transferRequest.beneficiary.name }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-map-marker text-xs"></i>
                Country
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                {{ transferRequest.beneficiary.country }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-building text-xs"></i>
                Destination Bank
              </div>
              <div class="text-base text-gray-900 dark:text-gray-100">
                {{ transferRequest.beneficiary.destinationBank }}
              </div>
            </div>
            <div class="space-y-1">
              <div class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                <i class="pi pi-credit-card text-xs"></i>
                Bank Account
              </div>
              <div class="text-base font-mono text-gray-900 dark:text-gray-100">
                {{ transferRequest.beneficiary.bankAccount || 'Not provided' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Documents -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
    <h5 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
      <i class="pi pi-file text-blue-600 dark:text-blue-400"></i>
      Documents
    </h5>
    <div *ngIf="transferRequest.documents?.length; else noDocuments" class="mt-4 space-y-2">
      <div *ngFor="let doc of transferRequest.documents" class="file-item flex items-center justify-between">
        <a 
          class="file-name cursor-pointer text-blue-600 dark:text-blue-400 hover:underline" 
          (click)="openDocument(doc.idDocument, doc.fileName)"
          pTooltip="Click to open document">
          {{ doc.fileName }}
        </a>
        <button
          *ngIf="!isEditDisabled(transferRequest.status)"
          pButton
          pRipple
          icon="pi pi-trash"
          class="action-btn action-btn-delete"
          (click)="deleteDocument(doc.idDocument)">
        </button>
      </div>
    </div>
    <ng-template #noDocuments>
      <p class="text-gray-500 dark:text-gray-400 mt-4">No documents uploaded.</p>
    </ng-template>
  </div>

      <!-- Enhanced Available Actions Section -->
      <div *ngIf="canPerformActions()" class="actions-section-redesigned">
        <div class="actions-header-redesigned">
          <h5 class="actions-title-redesigned">
            <i class="pi pi-cog text-gray-600 dark:text-gray-400"></i>
            Available Actions
          </h5>
          <p class="actions-subtitle">Choose an action to proceed with this transfer request</p>
        </div>
        <div class="actions-content-redesigned">
          <div class="actions-grid-redesigned">
            <button
              pButton
              pRipple
              class="action-button-redesigned action-validate-redesigned"
              [disabled]="isLoading"
              [class.loading]="isLoading"
              pTooltip="Approve this transfer request"
              (click)="validateTransferRequest()">
              <div class="action-icon-redesigned">
                <i class="pi pi-check" *ngIf="!isLoading"></i>
                <i class="pi pi-spin pi-spinner" *ngIf="isLoading"></i>
              </div>
              <div class="action-content-redesigned">
                <span class="action-title-redesigned">Validate</span>
                <span class="action-description-redesigned">Approve request</span>
              </div>
            </button>
            
            <button
              pButton
              pRipple
              class="action-button-redesigned action-reject-redesigned"
              [disabled]="isLoading"
              [class.loading]="isLoading"
              pTooltip="Reject this transfer request"
              (click)="rejectTransferRequest()">
              <div class="action-icon-redesigned">
                <i class="pi pi-times" *ngIf="!isLoading"></i>
                <i class="pi pi-spin pi-spinner" *ngIf="isLoading"></i>
              </div>
              <div class="action-content-redesigned">
                <span class="action-title-redesigned">Reject</span>
                <span class="action-description-redesigned">Decline request</span>
              </div>
            </button>
            
            <button
              pButton
              pRipple
              class="action-button-redesigned action-request-info-redesigned"
              [disabled]="isLoading"
              [class.loading]="isLoading"
              pTooltip="Request additional information"
              (click)="requestAdditionalInfo()">
              <div class="action-icon-redesigned">
                <i class="pi pi-info-circle" *ngIf="!isLoading"></i>
                <i class="pi pi-spin pi-spinner" *ngIf="isLoading"></i>
              </div>
              <div class="action-content-redesigned">
                <span class="action-title-redesigned">Request Info</span>
                <span class="action-description-redesigned">Ask for details</span>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #loadingTemplate>
      <div class="flex items-center justify-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
      </div>
    </ng-template>
  </div>
</div>

<p-toast></p-toast>
<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>